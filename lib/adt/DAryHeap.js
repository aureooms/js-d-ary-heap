'use strict';

Object.defineProperty(exports, "__esModule", {
	value: true
});
exports.default = DAryHeap;

var _core = require('../core');

function DAryHeap(arity, compare) {

	// arity of this heap

	this.arity = arity;

	// the comparison function

	this.compare = function (a, b) {
		return compare(a.value, b.value);
	};

	// the original comparison function

	this._compare = compare;

	// array used to store values

	this.array = [];

	// size of the heap

	this.length = 0;
}

DAryHeap.Reference = function (index, value) {

	this.index = index;
	this.value = value;
};

DAryHeap.prototype.swap = function (a, i, j) {

	var tmp = a[i];
	a[i] = a[j];
	a[j] = tmp;

	a[i].index = i;
	a[j].index = j;
};

DAryHeap.prototype.head = function () {

	if (this.length === 0) {
		return undefined;
	}

	return this.array[0].value;
};

DAryHeap.prototype.headreference = function () {

	if (this.length === 0) {
		return null;
	}

	return this.array[0];
};

DAryHeap.prototype.pop = function () {

	var a, i, j, reference;

	if (this.length === 0) {
		return undefined;
	}

	a = this.array;
	i = 0;
	j = a.length;

	reference = (0, _core.pop)(this.arity, this.compare, this.swap, a, i, j);

	a.pop();

	--this.length;

	return reference.value;
};

DAryHeap.prototype.popreference = function () {

	var a, i, j, reference;

	if (this.length === 0) {
		return null;
	}

	a = this.array;
	i = 0;
	j = a.length;

	reference = (0, _core.pop)(this.arity, this.compare, this.swap, a, i, j);

	a.pop();

	--this.length;

	return reference;
};

DAryHeap.prototype.push = function (value) {

	var a, i, j, reference;

	a = this.array;
	i = 0;
	j = a.length;

	reference = new DAryHeap.Reference(j, value);

	a.push(reference);

	(0, _core.push)(this.arity, this.compare, this.swap, a, i, j);

	++this.length;

	return reference;
};

DAryHeap.prototype.pushreference = function (reference) {

	var a, i, j;

	a = this.array;
	i = 0;
	j = a.length;

	reference.index = j;
	a.push(reference);

	(0, _core.push)(this.arity, this.compare, this.swap, a, i, j);

	++this.length;
};

DAryHeap.prototype.merge = function (other) {

	var a, i, j, k, t;

	a = this.array;
	i = 0;
	j = a.length;

	// concat arrays of both heaps

	a = this.array = a.concat(other.array);

	k = a.length;

	// update index of concatenated elements

	for (t = j; t < k; ++t) {
		a[t].index = t;
	}

	(0, _core.merge)(this.arity, this.compare, this.swap, a, i, j, k);

	this.length += other.length;
};

DAryHeap.prototype.update = function (reference, value) {

	var d;

	d = this._compare(value, reference.value);

	if (d < 0) {
		this.decreasekey(reference, value);
	} else if (d > 0) {
		this.increasekey(reference, value);
	} else {

		// d === 0 does not imply reference.value === value

		reference.value = value;
	}
};

DAryHeap.prototype.decreasekey = function (reference, value) {

	var a, i, j, k;

	a = this.array;
	i = 0;
	j = a.length;
	k = reference.index;

	reference.value = value;

	(0, _core.siftup)(this.arity, this.compare, this.swap, a, i, j, k);
};

DAryHeap.prototype.increasekey = function (reference, value) {

	var a, i, j, k;

	a = this.array;
	i = 0;
	j = a.length;
	k = reference.index;

	reference.value = value;

	(0, _core.siftdown)(this.arity, this.compare, this.swap, a, i, j, k);
};

DAryHeap.prototype.delete = function (reference) {

	var a, i, j, k;

	a = this.array;
	i = 0;
	j = a.length;
	k = reference.index;

	(0, _core.remove)(this.arity, this.compare, this.swap, a, i, j, k);

	a.pop();

	--this.length;
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9hZHQvREFyeUhlYXAuanMiXSwibmFtZXMiOlsiREFyeUhlYXAiLCJhcml0eSIsImNvbXBhcmUiLCJhIiwiYiIsInZhbHVlIiwiX2NvbXBhcmUiLCJhcnJheSIsImxlbmd0aCIsIlJlZmVyZW5jZSIsImluZGV4IiwicHJvdG90eXBlIiwic3dhcCIsImkiLCJqIiwidG1wIiwiaGVhZCIsInVuZGVmaW5lZCIsImhlYWRyZWZlcmVuY2UiLCJwb3AiLCJyZWZlcmVuY2UiLCJwb3ByZWZlcmVuY2UiLCJwdXNoIiwicHVzaHJlZmVyZW5jZSIsIm1lcmdlIiwib3RoZXIiLCJrIiwidCIsImNvbmNhdCIsInVwZGF0ZSIsImQiLCJkZWNyZWFzZWtleSIsImluY3JlYXNla2V5IiwiZGVsZXRlIl0sIm1hcHBpbmdzIjoiOzs7OztrQkFHd0JBLFE7O0FBRnhCOztBQUVlLFNBQVNBLFFBQVQsQ0FBb0JDLEtBQXBCLEVBQTJCQyxPQUEzQixFQUFxQzs7QUFFbkQ7O0FBRUEsTUFBS0QsS0FBTCxHQUFhQSxLQUFiOztBQUdBOztBQUVBLE1BQUtDLE9BQUwsR0FBZSxVQUFXQyxDQUFYLEVBQWNDLENBQWQsRUFBa0I7QUFDaEMsU0FBT0YsUUFBU0MsRUFBRUUsS0FBWCxFQUFrQkQsRUFBRUMsS0FBcEIsQ0FBUDtBQUNBLEVBRkQ7O0FBS0E7O0FBRUEsTUFBS0MsUUFBTCxHQUFnQkosT0FBaEI7O0FBR0E7O0FBRUEsTUFBS0ssS0FBTCxHQUFhLEVBQWI7O0FBR0E7O0FBRUEsTUFBS0MsTUFBTCxHQUFjLENBQWQ7QUFFQTs7QUFHRFIsU0FBU1MsU0FBVCxHQUFxQixVQUFXQyxLQUFYLEVBQWtCTCxLQUFsQixFQUEwQjs7QUFFOUMsTUFBS0ssS0FBTCxHQUFhQSxLQUFiO0FBQ0EsTUFBS0wsS0FBTCxHQUFhQSxLQUFiO0FBRUEsQ0FMRDs7QUFRQUwsU0FBU1csU0FBVCxDQUFtQkMsSUFBbkIsR0FBMEIsVUFBV1QsQ0FBWCxFQUFjVSxDQUFkLEVBQWlCQyxDQUFqQixF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QUFVLEtBQUtKLEtBQWYsRUFBc0IsS0FBS0MsT0FBM0IsRUFBb0MsS0FBS1UsSUFBekMsRUFBK0NULENBQS9DLEVBQWtEVSxDQUFsRCxFQUFxREMsQ0FBckQsRUFBd0RZLENBQXhEO0FBRUEsQ0FiRDs7QUFlQTFCLFNBQVNXLFNBQVQsQ0FBbUJzQixNQUFuQixHQUE0QixVQUFXYixTQUFYLEVBQXVCOztBQUVsRCxLQUFJakIsQ0FBSixFQUFPVSxDQUFQLEVBQVVDLENBQVYsRUFBYVksQ0FBYjs7QUFFQXZCLEtBQUksS0FBS0ksS0FBVDtBQUNBTSxLQUFJLENBQUo7QUFDQUMsS0FBSVgsRUFBRUssTUFBTjtBQUNBa0IsS0FBSU4sVUFBVVYsS0FBZDs7QUFFQSxtQkFBUSxLQUFLVCxLQUFiLEVBQW9CLEtBQUtDLE9BQXpCLEVBQWtDLEtBQUtVLElBQXZDLEVBQTZDVCxDQUE3QyxFQUFnRFUsQ0FBaEQsRUFBbURDLENBQW5ELEVBQXNEWSxDQUF0RDs7QUFFQXZCLEdBQUVnQixHQUFGOztBQUVBLEdBQUUsS0FBS1gsTUFBUDtBQUVBLENBZkQiLCJmaWxlIjoiREFyeUhlYXAuanMiLCJzb3VyY2VzQ29udGVudCI6WyJcbmltcG9ydCB7IHBvcCAsIHB1c2ggLCBtZXJnZSAsIHNpZnR1cCAsIHNpZnRkb3duICwgcmVtb3ZlIH0gZnJvbSAnLi4vY29yZScgO1xuXG5leHBvcnQgZGVmYXVsdCBmdW5jdGlvbiBEQXJ5SGVhcCAoIGFyaXR5LCBjb21wYXJlICkge1xuXG5cdC8vIGFyaXR5IG9mIHRoaXMgaGVhcFxuXG5cdHRoaXMuYXJpdHkgPSBhcml0eTtcblxuXG5cdC8vIHRoZSBjb21wYXJpc29uIGZ1bmN0aW9uXG5cblx0dGhpcy5jb21wYXJlID0gZnVuY3Rpb24gKCBhLCBiICkge1xuXHRcdHJldHVybiBjb21wYXJlKCBhLnZhbHVlLCBiLnZhbHVlICk7XG5cdH07XG5cblxuXHQvLyB0aGUgb3JpZ2luYWwgY29tcGFyaXNvbiBmdW5jdGlvblxuXG5cdHRoaXMuX2NvbXBhcmUgPSBjb21wYXJlO1xuXG5cblx0Ly8gYXJyYXkgdXNlZCB0byBzdG9yZSB2YWx1ZXNcblxuXHR0aGlzLmFycmF5ID0gW107XG5cblxuXHQvLyBzaXplIG9mIHRoZSBoZWFwXG5cblx0dGhpcy5sZW5ndGggPSAwO1xuXG59XG5cblxuREFyeUhlYXAuUmVmZXJlbmNlID0gZnVuY3Rpb24gKCBpbmRleCwgdmFsdWUgKSB7XG5cblx0dGhpcy5pbmRleCA9IGluZGV4O1xuXHR0aGlzLnZhbHVlID0gdmFsdWU7XG5cbn07XG5cblxuREFyeUhlYXAucHJvdG90eXBlLnN3YXAgPSBmdW5jdGlvbiAoIGEsIGksIGogKSB7XG5cblx0Y29uc3QgdG1wID0gYVtpXTtcblx0YVtpXSA9IGFbal07XG5cdGFbal0gPSB0bXA7XG5cblx0YVtpXS5pbmRleCA9IGk7XG5cdGFbal0uaW5kZXggPSBqO1xuXG59O1xuXG5cbkRBcnlIZWFwLnByb3RvdHlwZS5oZWFkID0gZnVuY3Rpb24gKCkge1xuXG5cdGlmICggdGhpcy5sZW5ndGggPT09IDAgKSB7XG5cdFx0cmV0dXJuIHVuZGVmaW5lZDtcblx0fVxuXG5cdHJldHVybiB0aGlzLmFycmF5WzBdLnZhbHVlO1xuXG59O1xuXG5cbkRBcnlIZWFwLnByb3RvdHlwZS5oZWFkcmVmZXJlbmNlID0gZnVuY3Rpb24gKCkge1xuXG5cdGlmICggdGhpcy5sZW5ndGggPT09IDAgKSB7XG5cdFx0cmV0dXJuIG51bGw7XG5cdH1cblxuXHRyZXR1cm4gdGhpcy5hcnJheVswXTtcblxufTtcblxuXG5EQXJ5SGVhcC5wcm90b3R5cGUucG9wID0gZnVuY3Rpb24gKCkge1xuXG5cdHZhciBhLCBpLCBqLCByZWZlcmVuY2U7XG5cblx0aWYgKCB0aGlzLmxlbmd0aCA9PT0gMCApIHtcblx0XHRyZXR1cm4gdW5kZWZpbmVkO1xuXHR9XG5cblx0YSA9IHRoaXMuYXJyYXk7XG5cdGkgPSAwO1xuXHRqID0gYS5sZW5ndGg7XG5cblx0cmVmZXJlbmNlID0gcG9wKCB0aGlzLmFyaXR5LCB0aGlzLmNvbXBhcmUsIHRoaXMuc3dhcCwgYSwgaSwgaiApO1xuXG5cdGEucG9wKCk7XG5cblx0LS10aGlzLmxlbmd0aDtcblxuXHRyZXR1cm4gcmVmZXJlbmNlLnZhbHVlO1xuXG59O1xuXG5cbkRBcnlIZWFwLnByb3RvdHlwZS5wb3ByZWZlcmVuY2UgPSBmdW5jdGlvbiAoKSB7XG5cblx0dmFyIGEsIGksIGosIHJlZmVyZW5jZTtcblxuXHRpZiAoIHRoaXMubGVuZ3RoID09PSAwICkge1xuXHRcdHJldHVybiBudWxsO1xuXHR9XG5cblx0YSA9IHRoaXMuYXJyYXk7XG5cdGkgPSAwO1xuXHRqID0gYS5sZW5ndGg7XG5cblx0cmVmZXJlbmNlID0gcG9wKCB0aGlzLmFyaXR5LCB0aGlzLmNvbXBhcmUsIHRoaXMuc3dhcCwgYSwgaSwgaiApO1xuXG5cdGEucG9wKCk7XG5cblx0LS10aGlzLmxlbmd0aDtcblxuXHRyZXR1cm4gcmVmZXJlbmNlO1xuXG59O1xuXG5cbkRBcnlIZWFwLnByb3RvdHlwZS5wdXNoID0gZnVuY3Rpb24gKCB2YWx1ZSApIHtcblxuXHR2YXIgYSwgaSwgaiwgcmVmZXJlbmNlO1xuXG5cdGEgPSB0aGlzLmFycmF5O1xuXHRpID0gMDtcblx0aiA9IGEubGVuZ3RoO1xuXG5cdHJlZmVyZW5jZSA9IG5ldyBEQXJ5SGVhcC5SZWZlcmVuY2UoIGosIHZhbHVlICk7XG5cblx0YS5wdXNoKCByZWZlcmVuY2UgKTtcblxuXHRwdXNoKCB0aGlzLmFyaXR5LCB0aGlzLmNvbXBhcmUsIHRoaXMuc3dhcCwgYSwgaSwgaiApO1xuXG5cdCsrdGhpcy5sZW5ndGg7XG5cblx0cmV0dXJuIHJlZmVyZW5jZTtcblxufTtcblxuXG5EQXJ5SGVhcC5wcm90b3R5cGUucHVzaHJlZmVyZW5jZSA9IGZ1bmN0aW9uICggcmVmZXJlbmNlICkge1xuXG5cdHZhciBhLCBpLCBqO1xuXG5cdGEgPSB0aGlzLmFycmF5O1xuXHRpID0gMDtcblx0aiA9IGEubGVuZ3RoO1xuXG5cblx0cmVmZXJlbmNlLmluZGV4ID0gajtcblx0YS5wdXNoKCByZWZlcmVuY2UgKTtcblxuXHRwdXNoKCB0aGlzLmFyaXR5LCB0aGlzLmNvbXBhcmUsIHRoaXMuc3dhcCwgYSwgaSwgaiApO1xuXG5cdCsrdGhpcy5sZW5ndGg7XG5cbn07XG5cblxuREFyeUhlYXAucHJvdG90eXBlLm1lcmdlID0gZnVuY3Rpb24gKCBvdGhlciApIHtcblxuXHR2YXIgYSwgaSwgaiwgaywgdDtcblxuXHRhID0gdGhpcy5hcnJheTtcblx0aSA9IDA7XG5cdGogPSBhLmxlbmd0aDtcblxuXHQvLyBjb25jYXQgYXJyYXlzIG9mIGJvdGggaGVhcHNcblxuXHRhID0gdGhpcy5hcnJheSA9IGEuY29uY2F0KCBvdGhlci5hcnJheSApO1xuXG5cdGsgPSBhLmxlbmd0aDtcblxuXHQvLyB1cGRhdGUgaW5kZXggb2YgY29uY2F0ZW5hdGVkIGVsZW1lbnRzXG5cblx0Zm9yICggdCA9IGogOyB0IDwgayA7ICsrdCApIHtcblx0XHRhW3RdLmluZGV4ID0gdDtcblx0fVxuXG5cdG1lcmdlKCB0aGlzLmFyaXR5LCB0aGlzLmNvbXBhcmUsIHRoaXMuc3dhcCwgYSwgaSwgaiwgayApO1xuXG5cdHRoaXMubGVuZ3RoICs9IG90aGVyLmxlbmd0aDtcblxufTtcblxuXG5EQXJ5SGVhcC5wcm90b3R5cGUudXBkYXRlID0gZnVuY3Rpb24gKCByZWZlcmVuY2UsIHZhbHVlICkge1xuXG5cdHZhciBkO1xuXG5cdGQgPSB0aGlzLl9jb21wYXJlKCB2YWx1ZSwgcmVmZXJlbmNlLnZhbHVlICk7XG5cblx0aWYgKCBkIDwgMCApIHtcblx0XHR0aGlzLmRlY3JlYXNla2V5KCByZWZlcmVuY2UsIHZhbHVlICk7XG5cdH1cblxuXHRlbHNlIGlmICggZCA+IDAgKSB7XG5cdFx0dGhpcy5pbmNyZWFzZWtleSggcmVmZXJlbmNlLCB2YWx1ZSApO1xuXHR9XG5cblx0ZWxzZSB7XG5cblx0XHQvLyBkID09PSAwIGRvZXMgbm90IGltcGx5IHJlZmVyZW5jZS52YWx1ZSA9PT0gdmFsdWVcblxuXHRcdHJlZmVyZW5jZS52YWx1ZSA9IHZhbHVlO1xuXG5cdH1cblxufTtcblxuREFyeUhlYXAucHJvdG90eXBlLmRlY3JlYXNla2V5ID0gZnVuY3Rpb24gKCByZWZlcmVuY2UsIHZhbHVlICkge1xuXG5cdHZhciBhLCBpLCBqLCBrO1xuXG5cdGEgPSB0aGlzLmFycmF5O1xuXHRpID0gMDtcblx0aiA9IGEubGVuZ3RoO1xuXHRrID0gcmVmZXJlbmNlLmluZGV4O1xuXG5cdHJlZmVyZW5jZS52YWx1ZSA9IHZhbHVlO1xuXG5cdHNpZnR1cCggdGhpcy5hcml0eSwgdGhpcy5jb21wYXJlLCB0aGlzLnN3YXAsIGEsIGksIGosIGsgKTtcblxufTtcblxuREFyeUhlYXAucHJvdG90eXBlLmluY3JlYXNla2V5ID0gZnVuY3Rpb24gKCByZWZlcmVuY2UsIHZhbHVlICkge1xuXG5cdHZhciBhLCBpLCBqLCBrO1xuXG5cdGEgPSB0aGlzLmFycmF5O1xuXHRpID0gMDtcblx0aiA9IGEubGVuZ3RoO1xuXHRrID0gcmVmZXJlbmNlLmluZGV4O1xuXG5cdHJlZmVyZW5jZS52YWx1ZSA9IHZhbHVlO1xuXG5cdHNpZnRkb3duKCB0aGlzLmFyaXR5LCB0aGlzLmNvbXBhcmUsIHRoaXMuc3dhcCwgYSwgaSwgaiwgayApO1xuXG59O1xuXG5EQXJ5SGVhcC5wcm90b3R5cGUuZGVsZXRlID0gZnVuY3Rpb24gKCByZWZlcmVuY2UgKSB7XG5cblx0dmFyIGEsIGksIGosIGs7XG5cblx0YSA9IHRoaXMuYXJyYXk7XG5cdGkgPSAwO1xuXHRqID0gYS5sZW5ndGg7XG5cdGsgPSByZWZlcmVuY2UuaW5kZXg7XG5cblx0cmVtb3ZlKCB0aGlzLmFyaXR5LCB0aGlzLmNvbXBhcmUsIHRoaXMuc3dhcCwgYSwgaSwgaiwgayApO1xuXG5cdGEucG9wKCk7XG5cblx0LS10aGlzLmxlbmd0aDtcblxufTtcbiJdfQ==