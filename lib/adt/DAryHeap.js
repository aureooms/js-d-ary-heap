"use strict";

Object.defineProperty(exports, "__esModule", {
	value: true
});
exports.default = DAryHeap;
function DAryHeap(arity, compare) {

	// arity of this heap

	this.arity = arity;

	// the comparison function

	this.compare = function (a, b) {
		return compare(a.value, b.value);
	};

	// the original comparison function

	this._compare = compare;

	// array used to store values

	this.array = [];

	// size of the heap

	this.length = 0;
}

DAryHeap.Reference = function (index, value) {

	this.index = index;
	this.value = value;
};

DAryHeap.prototype.swap = function (a, i, j) {

	var tmp;

	tmp = a[i];
	a[i] = a[j];
	a[j] = tmp;

	a[i].index = i;
	a[j].index = j;
};

DAryHeap.prototype.head = function () {

	if (this.length === 0) {
		return undefined;
	}

	return this.array[0].value;
};

DAryHeap.prototype.headreference = function () {

	if (this.length === 0) {
		return null;
	}

	return this.array[0];
};

DAryHeap.prototype.pop = function () {

	var a, i, j, reference;

	if (this.length === 0) {
		return undefined;
	}

	a = this.array;
	i = 0;
	j = a.length;

	reference = pop(this.arity, this.compare, this.swap, a, i, j);

	a.pop();

	--this.length;

	return reference.value;
};

DAryHeap.prototype.popreference = function () {

	var a, i, j, reference;

	if (this.length === 0) {
		return null;
	}

	a = this.array;
	i = 0;
	j = a.length;

	reference = pop(this.arity, this.compare, this.swap, a, i, j);

	a.pop();

	--this.length;

	return reference;
};

DAryHeap.prototype.push = function (value) {

	var a, i, j, reference;

	a = this.array;
	i = 0;
	j = a.length;

	reference = new DAryHeap.Reference(j, value);

	a.push(reference);

	push(this.arity, this.compare, this.swap, a, i, j);

	++this.length;

	return reference;
};

DAryHeap.prototype.pushreference = function (reference) {

	var a, i, j;

	a = this.array;
	i = 0;
	j = a.length;

	reference.index = j;
	a.push(reference);

	push(this.arity, this.compare, this.swap, a, i, j);

	++this.length;
};

DAryHeap.prototype.merge = function (other) {

	var a, i, j, k, t;

	a = this.array;
	i = 0;
	j = a.length;

	// concat arrays of both heaps

	a = this.array = a.concat(other.array);

	k = a.length;

	// update index of concatenated elements

	for (t = j; t < k; ++t) {
		a[t].index = t;
	}

	merge(this.arity, this.compare, this.swap, a, i, j, k);

	this.length += other.length;
};

DAryHeap.prototype.update = function (reference, value) {

	var d;

	d = this._compare(value, reference.value);

	if (d < 0) {
		this.decreasekey(reference, value);
	} else if (d > 0) {
		this.increasekey(reference, value);
	} else {

		// d === 0 does not imply reference.value === value

		reference.value = value;
	}
};

DAryHeap.prototype.decreasekey = function (reference, value) {

	var a, i, j, k;

	a = this.array;
	i = 0;
	j = a.length;
	k = reference.index;

	reference.value = value;

	siftup(this.arity, this.compare, this.swap, a, i, j, k);
};

DAryHeap.prototype.increasekey = function (reference, value) {

	var a, i, j, k;

	a = this.array;
	i = 0;
	j = a.length;
	k = reference.index;

	reference.value = value;

	siftdown(this.arity, this.compare, this.swap, a, i, j, k);
};

DAryHeap.prototype.delete = function (reference) {

	var a, i, j, k;

	a = this.array;
	i = 0;
	j = a.length;
	k = reference.index;

	remove(this.arity, this.compare, this.swap, a, i, j, k);

	a.pop();

	--this.length;
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9hZHQvREFyeUhlYXAuanMiXSwibmFtZXMiOlsiREFyeUhlYXAiLCJhcml0eSIsImNvbXBhcmUiLCJhIiwiYiIsInZhbHVlIiwiX2NvbXBhcmUiLCJhcnJheSIsImxlbmd0aCIsIlJlZmVyZW5jZSIsImluZGV4IiwicHJvdG90eXBlIiwic3dhcCIsImkiLCJqIiwidG1wIiwiaGVhZCIsInVuZGVmaW5lZCIsImhlYWRyZWZlcmVuY2UiLCJwb3AiLCJyZWZlcmVuY2UiLCJwb3ByZWZlcmVuY2UiLCJwdXNoIiwicHVzaHJlZmVyZW5jZSIsIm1lcmdlIiwib3RoZXIiLCJrIiwidCIsImNvbmNhdCIsInVwZGF0ZSIsImQiLCJkZWNyZWFzZWtleSIsImluY3JlYXNla2V5Iiwic2lmdHVwIiwic2lmdGRvd24iLCJkZWxldGUiLCJyZW1vdmUiXSwibWFwcGluZ3MiOiI7Ozs7O2tCQUV3QkEsUTtBQUFULFNBQVNBLFFBQVQsQ0FBb0JDLEtBQXBCLEVBQTJCQyxPQUEzQixFQUFxQzs7QUFFbkQ7O0FBRUEsTUFBS0QsS0FBTCxHQUFhQSxLQUFiOztBQUdBOztBQUVBLE1BQUtDLE9BQUwsR0FBZSxVQUFXQyxDQUFYLEVBQWNDLENBQWQsRUFBa0I7QUFDaEMsU0FBT0YsUUFBU0MsRUFBRUUsS0FBWCxFQUFrQkQsRUFBRUMsS0FBcEIsQ0FBUDtBQUNBLEVBRkQ7O0FBS0E7O0FBRUEsTUFBS0MsUUFBTCxHQUFnQkosT0FBaEI7O0FBR0E7O0FBRUEsTUFBS0ssS0FBTCxHQUFhLEVBQWI7O0FBR0E7O0FBRUEsTUFBS0MsTUFBTCxHQUFjLENBQWQ7QUFFQTs7QUFHRFIsU0FBU1MsU0FBVCxHQUFxQixVQUFXQyxLQUFYLEVBQWtCTCxLQUFsQixFQUEwQjs7QUFFOUMsTUFBS0ssS0FBTCxHQUFhQSxLQUFiO0FBQ0EsTUFBS0wsS0FBTCxHQUFhQSxLQUFiO0FBRUEsQ0FMRDs7QUFRQUwsU0FBU1csU0FBVCxDQUFtQkMsSUFBbkIsR0FBMEIsVUFBV1QsQ0FBWCxFQUFj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QUVBVSxXQUFVZixLQUFWLEdBQWtCQSxLQUFsQjs7QUFFQTZCLFVBQVUsS0FBS2pDLEtBQWYsRUFBc0IsS0FBS0MsT0FBM0IsRUFBb0MsS0FBS1UsSUFBekMsRUFBK0NULENBQS9DLEVBQWtEVSxDQUFsRCxFQUFxREMsQ0FBckQsRUFBd0RZLENBQXhEO0FBRUEsQ0FiRDs7QUFlQTFCLFNBQVNXLFNBQVQsQ0FBbUJ3QixNQUFuQixHQUE0QixVQUFXZixTQUFYLEVBQXVCOztBQUVsRCxLQUFJakIsQ0FBSixFQUFPVSxDQUFQLEVBQVVDLENBQVYsRUFBYVksQ0FBYjs7QUFFQXZCLEtBQUksS0FBS0ksS0FBVDtBQUNBTSxLQUFJLENBQUo7QUFDQUMsS0FBSVgsRUFBRUssTUFBTjtBQUNBa0IsS0FBSU4sVUFBVVYsS0FBZDs7QUFFQTBCLFFBQVEsS0FBS25DLEtBQWIsRUFBb0IsS0FBS0MsT0FBekIsRUFBa0MsS0FBS1UsSUFBdkMsRUFBNkNULENBQTdDLEVBQWdEVSxDQUFoRCxFQUFtREMsQ0FBbkQsRUFBc0RZLENBQXREOztBQUVBdkIsR0FBRWdCLEdBQUY7O0FBRUEsR0FBRSxLQUFLWCxNQUFQO0FBRUEsQ0FmRCIsImZpbGUiOiJEQXJ5SGVhcC5qcyIsInNvdXJjZXNDb250ZW50IjpbIlxuXG5leHBvcnQgZGVmYXVsdCBmdW5jdGlvbiBEQXJ5SGVhcCAoIGFyaXR5LCBjb21wYXJlICkge1xuXG5cdC8vIGFyaXR5IG9mIHRoaXMgaGVhcFxuXG5cdHRoaXMuYXJpdHkgPSBhcml0eTtcblxuXG5cdC8vIHRoZSBjb21wYXJpc29uIGZ1bmN0aW9uXG5cblx0dGhpcy5jb21wYXJlID0gZnVuY3Rpb24gKCBhLCBiICkge1xuXHRcdHJldHVybiBjb21wYXJlKCBhLnZhbHVlLCBiLnZhbHVlICk7XG5cdH07XG5cblxuXHQvLyB0aGUgb3JpZ2luYWwgY29tcGFyaXNvbiBmdW5jdGlvblxuXG5cdHRoaXMuX2NvbXBhcmUgPSBjb21wYXJlO1xuXG5cblx0Ly8gYXJyYXkgdXNlZCB0byBzdG9yZSB2YWx1ZXNcblxuXHR0aGlzLmFycmF5ID0gW107XG5cblxuXHQvLyBzaXplIG9mIHRoZSBoZWFwXG5cblx0dGhpcy5sZW5ndGggPSAwO1xuXG59XG5cblxuREFyeUhlYXAuUmVmZXJlbmNlID0gZnVuY3Rpb24gKCBpbmRleCwgdmFsdWUgKSB7XG5cblx0dGhpcy5pbmRleCA9IGluZGV4O1xuXHR0aGlzLnZhbHVlID0gdmFsdWU7XG5cbn07XG5cblxuREFyeUhlYXAucHJvdG90eXBlLnN3YXAgPSBmdW5jdGlvbiAoIGEsIGksIGogKSB7XG5cblx0dmFyIHRtcDtcblxuXHR0bXAgPSBhW2ldO1xuXHRhW2ldID0gYVtqXTtcblx0YVtqXSA9IHRtcDtcblxuXHRhW2ldLmluZGV4ID0gaTtcblx0YVtqXS5pbmRleCA9IGo7XG5cbn07XG5cblxuREFyeUhlYXAucHJvdG90eXBlLmhlYWQgPSBmdW5jdGlvbiAoKSB7XG5cblx0aWYgKCB0aGlzLmxlbmd0aCA9PT0gMCApIHtcblx0XHRyZXR1cm4gdW5kZWZpbmVkO1xuXHR9XG5cblx0cmV0dXJuIHRoaXMuYXJyYXlbMF0udmFsdWU7XG5cbn07XG5cblxuREFyeUhlYXAucHJvdG90eXBlLmhlYWRyZWZlcmVuY2UgPSBmdW5jdGlvbiAoKSB7XG5cblx0aWYgKCB0aGlzLmxlbmd0aCA9PT0gMCApIHtcblx0XHRyZXR1cm4gbnVsbDtcblx0fVxuXG5cdHJldHVybiB0aGlzLmFycmF5WzBdO1xuXG59O1xuXG5cbkRBcnlIZWFwLnByb3RvdHlwZS5wb3AgPSBmdW5jdGlvbiAoKSB7XG5cblx0dmFyIGEsIGksIGosIHJlZmVyZW5jZTtcblxuXHRpZiAoIHRoaXMubGVuZ3RoID09PSAwICkge1xuXHRcdHJldHVybiB1bmRlZmluZWQ7XG5cdH1cblxuXHRhID0gdGhpcy5hcnJheTtcblx0aSA9IDA7XG5cdGogPSBhLmxlbmd0aDtcblxuXHRyZWZlcmVuY2UgPSBwb3AoIHRoaXMuYXJpdHksIHRoaXMuY29tcGFyZSwgdGhpcy5zd2FwLCBhLCBpLCBqICk7XG5cblx0YS5wb3AoKTtcblxuXHQtLXRoaXMubGVuZ3RoO1xuXG5cdHJldHVybiByZWZlcmVuY2UudmFsdWU7XG5cbn07XG5cblxuREFyeUhlYXAucHJvdG90eXBlLnBvcHJlZmVyZW5jZSA9IGZ1bmN0aW9uICgpIHtcblxuXHR2YXIgYSwgaSwgaiwgcmVmZXJlbmNlO1xuXG5cdGlmICggdGhpcy5sZW5ndGggPT09IDAgKSB7XG5cdFx0cmV0dXJuIG51bGw7XG5cdH1cblxuXHRhID0gdGhpcy5hcnJheTtcblx0aSA9IDA7XG5cdGogPSBhLmxlbmd0aDtcblxuXHRyZWZlcmVuY2UgPSBwb3AoIHRoaXMuYXJpdHksIHRoaXMuY29tcGFyZSwgdGhpcy5zd2FwLCBhLCBpLCBqICk7XG5cblx0YS5wb3AoKTtcblxuXHQtLXRoaXMubGVuZ3RoO1xuXG5cdHJldHVybiByZWZlcmVuY2U7XG5cbn07XG5cblxuREFyeUhlYXAucHJvdG90eXBlLnB1c2ggPSBmdW5jdGlvbiAoIHZhbHVlICkge1xuXG5cdHZhciBhLCBpLCBqLCByZWZlcmVuY2U7XG5cblx0YSA9IHRoaXMuYXJyYXk7XG5cdGkgPSAwO1xuXHRqID0gYS5sZW5ndGg7XG5cblx0cmVmZXJlbmNlID0gbmV3IERBcnlIZWFwLlJlZmVyZW5jZSggaiwgdmFsdWUgKTtcblxuXHRhLnB1c2goIHJlZmVyZW5jZSApO1xuXG5cdHB1c2goIHRoaXMuYXJpdHksIHRoaXMuY29tcGFyZSwgdGhpcy5zd2FwLCBhLCBpLCBqICk7XG5cblx0Kyt0aGlzLmxlbmd0aDtcblxuXHRyZXR1cm4gcmVmZXJlbmNlO1xuXG59O1xuXG5cbkRBcnlIZWFwLnByb3RvdHlwZS5wdXNocmVmZXJlbmNlID0gZnVuY3Rpb24gKCByZWZlcmVuY2UgKSB7XG5cblx0dmFyIGEsIGksIGo7XG5cblx0YSA9IHRoaXMuYXJyYXk7XG5cdGkgPSAwO1xuXHRqID0gYS5sZW5ndGg7XG5cblxuXHRyZWZlcmVuY2UuaW5kZXggPSBqO1xuXHRhLnB1c2goIHJlZmVyZW5jZSApO1xuXG5cdHB1c2goIHRoaXMuYXJpdHksIHRoaXMuY29tcGFyZSwgdGhpcy5zd2FwLCBhLCBpLCBqICk7XG5cblx0Kyt0aGlzLmxlbmd0aDtcblxufTtcblxuXG5EQXJ5SGVhcC5wcm90b3R5cGUubWVyZ2UgPSBmdW5jdGlvbiAoIG90aGVyICkge1xuXG5cdHZhciBhLCBpLCBqLCBrLCB0O1xuXG5cdGEgPSB0aGlzLmFycmF5O1xuXHRpID0gMDtcblx0aiA9IGEubGVuZ3RoO1xuXG5cdC8vIGNvbmNhdCBhcnJheXMgb2YgYm90aCBoZWFwc1xuXG5cdGEgPSB0aGlzLmFycmF5ID0gYS5jb25jYXQoIG90aGVyLmFycmF5ICk7XG5cblx0ayA9IGEubGVuZ3RoO1xuXG5cdC8vIHVwZGF0ZSBpbmRleCBvZiBjb25jYXRlbmF0ZWQgZWxlbWVudHNcblxuXHRmb3IgKCB0ID0gaiA7IHQgPCBrIDsgKyt0ICkge1xuXHRcdGFbdF0uaW5kZXggPSB0O1xuXHR9XG5cblx0bWVyZ2UoIHRoaXMuYXJpdHksIHRoaXMuY29tcGFyZSwgdGhpcy5zd2FwLCBhLCBpLCBqLCBrICk7XG5cblx0dGhpcy5sZW5ndGggKz0gb3RoZXIubGVuZ3RoO1xuXG59O1xuXG5cbkRBcnlIZWFwLnByb3RvdHlwZS51cGRhdGUgPSBmdW5jdGlvbiAoIHJlZmVyZW5jZSwgdmFsdWUgKSB7XG5cblx0dmFyIGQ7XG5cblx0ZCA9IHRoaXMuX2NvbXBhcmUoIHZhbHVlLCByZWZlcmVuY2UudmFsdWUgKTtcblxuXHRpZiAoIGQgPCAwICkge1xuXHRcdHRoaXMuZGVjcmVhc2VrZXkoIHJlZmVyZW5jZSwgdmFsdWUgKTtcblx0fVxuXG5cdGVsc2UgaWYgKCBkID4gMCApIHtcblx0XHR0aGlzLmluY3JlYXNla2V5KCByZWZlcmVuY2UsIHZhbHVlICk7XG5cdH1cblxuXHRlbHNlIHtcblxuXHRcdC8vIGQgPT09IDAgZG9lcyBub3QgaW1wbHkgcmVmZXJlbmNlLnZhbHVlID09PSB2YWx1ZVxuXG5cdFx0cmVmZXJlbmNlLnZhbHVlID0gdmFsdWU7XG5cblx0fVxuXG59O1xuXG5EQXJ5SGVhcC5wcm90b3R5cGUuZGVjcmVhc2VrZXkgPSBmdW5jdGlvbiAoIHJlZmVyZW5jZSwgdmFsdWUgKSB7XG5cblx0dmFyIGEsIGksIGosIGs7XG5cblx0YSA9IHRoaXMuYXJyYXk7XG5cdGkgPSAwO1xuXHRqID0gYS5sZW5ndGg7XG5cdGsgPSByZWZlcmVuY2UuaW5kZXg7XG5cblx0cmVmZXJlbmNlLnZhbHVlID0gdmFsdWU7XG5cblx0c2lmdHVwKCB0aGlzLmFyaXR5LCB0aGlzLmNvbXBhcmUsIHRoaXMuc3dhcCwgYSwgaSwgaiwgayApO1xuXG59O1xuXG5EQXJ5SGVhcC5wcm90b3R5cGUuaW5jcmVhc2VrZXkgPSBmdW5jdGlvbiAoIHJlZmVyZW5jZSwgdmFsdWUgKSB7XG5cblx0dmFyIGEsIGksIGosIGs7XG5cblx0YSA9IHRoaXMuYXJyYXk7XG5cdGkgPSAwO1xuXHRqID0gYS5sZW5ndGg7XG5cdGsgPSByZWZlcmVuY2UuaW5kZXg7XG5cblx0cmVmZXJlbmNlLnZhbHVlID0gdmFsdWU7XG5cblx0c2lmdGRvd24oIHRoaXMuYXJpdHksIHRoaXMuY29tcGFyZSwgdGhpcy5zd2FwLCBhLCBpLCBqLCBrICk7XG5cbn07XG5cbkRBcnlIZWFwLnByb3RvdHlwZS5kZWxldGUgPSBmdW5jdGlvbiAoIHJlZmVyZW5jZSApIHtcblxuXHR2YXIgYSwgaSwgaiwgaztcblxuXHRhID0gdGhpcy5hcnJheTtcblx0aSA9IDA7XG5cdGogPSBhLmxlbmd0aDtcblx0ayA9IHJlZmVyZW5jZS5pbmRleDtcblxuXHRyZW1vdmUoIHRoaXMuYXJpdHksIHRoaXMuY29tcGFyZSwgdGhpcy5zd2FwLCBhLCBpLCBqLCBrICk7XG5cblx0YS5wb3AoKTtcblxuXHQtLXRoaXMubGVuZ3RoO1xuXG59O1xuIl19